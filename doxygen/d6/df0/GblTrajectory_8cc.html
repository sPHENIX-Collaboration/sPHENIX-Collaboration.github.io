<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=9" />
<title>Analysis Software: GenFit/blob/master/GBL/src/GblTrajectory.cc File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script> <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script> 
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
	<div id="top">
		<!-- do not remove this div, it is closed by doxygen! -->
		<div id="titlearea">
			<table cellspacing="0" cellpadding="0">
				<tbody>
					<tr style="height: 56px;">
						<td id="projectlogo"><a href="https://wiki.bnl.gov/sPHENIX/index.php/Main_Page"><img
								alt="Logo" src="../../sphenix.png" /></a></td>
						<td style="padding-left: 0.5em;">
							<div id="projectname">
								Analysis Software
							</div> 
							<div id="projectbrief">
								Documentation for <a href="https://wiki.bnl.gov/sPHENIX/index.php/Main_Page">sPHENIX</a> simulation software
							</div> 
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Home&#160;page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../usergroup0.html"><span>External&#160;Links</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d6/df0/GblTrajectory_8cc.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<div class="title">GblTrajectory.cc File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="../../d6/db0/GblTrajectory_8h_source.html">GblTrajectory.h</a>&quot;</code><br/>
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="../../closed.png" alt="+"/> Include dependency graph for GblTrajectory.cc:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d5/df8/GblTrajectory_8cc__incl.svg" width="1778" height="359"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</div>
<p><a href="../../d6/df0/GblTrajectory_8cc_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:db/d1c/namespacegbl"><td class="memItemLeft" align="right" valign="top">namespace &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d1c/namespacegbl.html">gbl</a></td></tr>
<tr class="memdesc:db/d1c/namespacegbl"><td class="mdescLeft">&#160;</td><td class="mdescRight">Namespace for the general broken lines package. <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>GblTrajectory methods.</p>
<dl class="section author"><dt>Author</dt><dd>Claus Kleinwort, DESY, 2011 (<a href="#" onclick="location.href='mai'+'lto:'+'Cla'+'us'+'.Kl'+'ei'+'nwo'+'rt'+'@de'+'sy'+'.de'; return false;">Claus<span style="display: none;">.nosp@m.</span>.Kle<span style="display: none;">.nosp@m.</span>inwor<span style="display: none;">.nosp@m.</span>t@de<span style="display: none;">.nosp@m.</span>sy.de</a>)</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright (c) 2011 - 2016 Deutsches Elektronen-Synchroton, Member of the Helmholtz Association, (DESY), HAMBURG, GERMANY <br/>
<br/>
 This library is free software; you can redistribute it and/or modify it under the terms of the GNU Library General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version. <br/>
<br/>
 This library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Library General Public License for more details. <br/>
<br/>
 You should have received a copy of the GNU Library General Public License along with this program (see the file COPYING.LIB for more details); if not, write to the Free Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</dd></dl>
<p>General information</p>
<p>Introduction</p>
<p>For a track with an initial trajectory from a prefit of the measurements (internal seed) or an external prediction (external seed) the description of multiple scattering is added by offsets in a local system. Along the initial trajectory points are defined with can describe a measurement or a (thin) scatterer or both. Measurements are arbitrary functions of the local track parameters at a point (e.g. 2D: position, 4D: direction+position). The refit provides corrections to the local track parameters (in the local system) and the corresponding covariance matrix at any of those points. Non-diagonal covariance matrices of measurements will be diagonalized internally. Outliers can be down-weighted by use of M-estimators.</p>
<p>A position measurement is in a plane defined by two directions. Along one direction the measurement precision may be zero, defining a 1D measurement in the other direction.</p>
<p>The broken lines trajectory is defined by (2D) offsets at the first and last point and all points with a scatterer. The prediction for a measurement is obtained by interpolation of the enclosing offsets and for triplets of adjacent offsets kink angles are determined. This requires for all points the jacobians for propagation to the previous and next offset. These are calculated from the point-to-point jacobians along the initial trajectory. The sequence of points has to be strictly monotonic in arc-length.</p>
<p>Additional local or global parameters can be added and the trajectories can be written to special binary files for calibration and alignment with Millepede-II. (V. Blobel, NIM A, 566 (2006), pp. 5-13).</p>
<p>Besides simple trajectories describing the path of a single particle composed trajectories are supported. These are constructed from the trajectories of multiple particles and some external parameters (like those describing a decay) and transformations at the first points from the external to the local track parameters.</p>
<p>The conventions for the coordinate systems follow: Derivation of Jacobians for the propagation of covariance matrices of track parameters in homogeneous magnetic fields A. Strandlie, W. Wittek, NIM A, 566 (2006) 687-698.</p>
<p>Calling sequence</p>
<ol type="1">
<li>Create list of points on initial trajectory:<br/>
 <code>std::vector&lt;GblPoint&gt; list</code></li>
<li>For all points on initial trajectory:<ul>
<li>Create points and add appropriate attributes:<br/>
<ul>
<li><code>point = <a class="el" href="../../da/d3b/classgbl_1_1GblPoint.html" title="Point on trajectory.">gbl::GblPoint</a>(..)</code></li>
<li><code>point.addMeasurement(..)</code></li>
<li>Add additional local or global parameters to measurement:<br/>
<ul>
<li><code>point.addLocals(..)</code></li>
<li><code>point.addGlobals(..)</code></li>
</ul>
</li>
<li><code>point.addScatterer(..)</code></li>
</ul>
</li>
<li>Add point (ordered by arc length) to list:<br/>
 <code>list.push_back(point)</code></li>
</ul>
</li>
<li>Create (simple) trajectory from list of points:<br/>
 <code>traj = <a class="el" href="../../dc/d6b/classgbl_1_1GblTrajectory.html" title="GBL trajectory.">gbl::GblTrajectory</a> (list)</code></li>
<li>Optionally with external seed:<br/>
 <code>traj = <a class="el" href="../../dc/d6b/classgbl_1_1GblTrajectory.html" title="GBL trajectory.">gbl::GblTrajectory</a> (list,seed)</code></li>
<li>Optionally check validity of trajectory:<br/>
 <code>if (not traj.isValid()) .. //abort</code></li>
<li>Fit trajectory, return error code, get Chi2, Ndf (and weight lost by M-estimators):<br/>
 <code>ierr = traj.fit(..)</code></li>
<li>For any point on initial trajectory:<ul>
<li>Get corrections and covariance matrix for track parameters:<br/>
 <code>[..] = traj.getResults(label)</code></li>
<li>Optionally get residuals with errors for measurements:<br/>
 <code>[..] = traj.getMeasResults(label) </code></li>
<li>Optionally get residuals with errors for scatterers:<br/>
 <code>[..] = traj.getScatResults(label) </code></li>
</ul>
</li>
<li>Optionally write trajectory to MP binary file (doesn't needs to be fitted):<br/>
 <code>traj.milleOut(..)</code></li>
</ol>
<p>Local system and local parameters At each point on the trajectory a local coordinate system with local track parameters has to be defined. The first of the five parameters describes the bending, the next two the direction and the last two the position (offsets). The curvilinear system (T,U,V) with parameters (q/p, lambda, phi, x_t, y_t) is well suited.</p>
<p>Implementation</p>
<p>Matrices are implemented with <a class="el" href="../../d0/d10/namespaceROOT.html">ROOT</a> (root.cern.ch). User input or output is in the form of TMatrices. Internally SMatrices are used for fixes sized and simple matrices based on std::vector&lt;&gt; for variable sized matrices.</p>
<p>References</p>
<ul>
<li>V. Blobel, C. Kleinwort, F. Meier, Fast alignment of a complex tracking detector using advanced track models, Computer Phys. Communications (2011), doi:10.1016/j.cpc.2011.03.017</li>
<li>C. Kleinwort, General Broken Lines as advanced track fitting method, NIM A, 673 (2012), 107-110, doi:10.1016/j.nima.2012.01.024 </li>
</ul>

<p>Definition in file <a class="el" href="../../d6/df0/GblTrajectory_8cc_source.html">GblTrajectory.cc</a>.</p>
</div></div><!-- contents -->
</div><!-- doc-content -->

<!-- start footer part -->
<div id="nav-path" class="navpath">
	<!-- id is needed for treeview function! -->
	<ul>
		<li class="navelem"><a class="el" href="../../dir_a43b3e750373d2fde1f3e46aab5a842b.html">GenFit</a></li><li class="navelem"><a class="el" href="../../dir_70d04667b22c727053792cf538f14175.html">blob</a></li><li class="navelem"><a class="el" href="../../dir_f7d4889b3c1b9f86296927366dca9cf4.html">master</a></li><li class="navelem"><a class="el" href="../../dir_071896cb88ee6af3cd4ca82c38fdb6d4.html">GBL</a></li><li class="navelem"><a class="el" href="../../dir_a4a561e3ee972dee050157131c0f8076.html">src</a></li><li class="navelem"><a class="el" href="../../d6/df0/GblTrajectory_8cc.html">GblTrajectory.cc</a></li>
		<li class="footer">
		Built by <a href="mailto:jhuang@bnl.gov">Jin Huang</a></em>.
			updated: <em>Mon Feb 17 2020 04:18:41</em> using <a
			href="http://www.doxygen.org/index.html"> <img class="footer"
				src="../../doxygen.png" alt="doxygen" /></a> 1.8.2 
				with <a href="https://github.com/sPHENIX-Collaboration">sPHENIX GitHub integration</a>
		</li>
	</ul>
</div>
</body>
</html>
