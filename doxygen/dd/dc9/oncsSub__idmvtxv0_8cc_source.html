<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=9" />
<title>Analysis Software: online_distribution/blob/master/newbasic/oncsSub_idmvtxv0.cc Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script> <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script> 
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
	<div id="top">
		<!-- do not remove this div, it is closed by doxygen! -->
		<div id="titlearea">
			<table cellspacing="0" cellpadding="0">
				<tbody>
					<tr style="height: 56px;">
						<td id="projectlogo"><a href="https://wiki.bnl.gov/sPHENIX/index.php/Main_Page"><img
								alt="Logo" src="../../sphenix.png" /></a></td>
						<td style="padding-left: 0.5em;">
							<div id="projectname">
								Analysis Software
							</div> 
							<div id="projectbrief">
								Documentation for <a href="https://wiki.bnl.gov/sPHENIX/index.php/Main_Page">sPHENIX</a> simulation software
							</div> 
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Home&#160;page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../usergroup0.html"><span>External&#160;Links</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('dd/dc9/oncsSub__idmvtxv0_8cc_source.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">oncsSub_idmvtxv0.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../dd/dc9/oncsSub__idmvtxv0_8cc.html">Go to the documentation of this file.</a> Or view <a target="top" href="https://github.com/sPHENIX-Collaboration//online_distribution/blob/master/newbasic/oncsSub_idmvtxv0.cc">the newest version in sPHENIX GitHub for file oncsSub_idmvtxv0.cc</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/d03/oncsSub__idmvtxv0_8h.html">oncsSub_idmvtxv0.h</a>&quot;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &lt;cstring&gt;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;bitset&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;arpa/inet.h&gt;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">using namespace </span>std;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno"><a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a334bc5099a6da8f969f4044a1c0abf03">   11</a></span>&#160;<a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a334bc5099a6da8f969f4044a1c0abf03">oncsSub_idmvtxv0::oncsSub_idmvtxv0</a>(<a class="code" href="../../dc/dde/structsubevt__data.html">subevtdata_ptr</a> <a class="code" href="../../d4/d23/Prototype2_2EMCal_2macros_2EnergyCalibFit_8m.html#a15fcda376b4587eb14bd059b030ea6b5">data</a>)</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    :<a class="code" href="../../d9/d6e/classoncsSubevent__w4.html">oncsSubevent_w4</a> (data)</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;{</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#aa8703a60ef4a64c5052daf2ee7cb3695">_is_decoded</a> = 0;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a4840315980c57bc875ca1e68e17e5251">_unexpected_felix_counter</a> = 0;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a424e472a49ad87d4f368d2d03709cd46">_bad_ruid</a> = 0;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a8b700908534a559b3a688aad3fd09fc6">_bad_ruchns</a> = 0;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ac9fa17644bb527dfa9462fa23867078a">_bad_chipids</a> = 0;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#afa0204c33ee474d131b380a25165862d">_highest_row_overall</a> = -1;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad644193fc95b47a7c14178eb4a19d5b1">_highest_chip</a> = -1;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    memset ( <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ab7dd5b3d859b50ef1e7d59a0d1a9449a">chip_row</a>, 0, 9*512*32*<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    memset ( <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a5b6abdd915c2b42ec44ca5e446d98714">chip_rowmap</a>, 0, 9*512*<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; <a class="code" href="../../d4/d03/oncsSub__idmvtxv0_8h.html#a9cc2f29007968c6b1f678db38d3d7206">MAXRUCHN</a>+1; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    {</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#adb98379eed23fff90768d6c94271f15b">_chip_id</a>[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>] = -1;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a1ee476a3583444ba2a88de2e03f9970e">_highest_region</a>[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>] = -1;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a1ee592d9a050cff11890abb619342170">_unexpected_bytes</a>[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>] = 0;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#aa17f4c0fcaa43a401bdd61fa63471c3a">_bunchcounter</a>[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>] = -1;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a9116c7596962d2c7e0cd463a33dbc28f">_header_found</a>[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#afe00b0d7496da4f3d99f729cdfb04d41">_trailer_found</a>[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ae558449fe46148bc1d6ec5e15d8ccd8b">_readout_flags</a>[<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>] = -1;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    }</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a3d44da2838da51c7ae651990db5095c8">_excess_data_bytes</a> = 0;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;}</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno"><a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ab892b92a2fe268969a8b839529912a32">   36</a></span>&#160;<a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ab892b92a2fe268969a8b839529912a32">oncsSub_idmvtxv0::~oncsSub_idmvtxv0</a>()</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;{</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;}</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="code" href="../../de/d6b/structdata32.html">   42</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;{</div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="code" href="../../de/d6b/structdata32.html#aeb7e57246917d82b70c12153310c317f">   44</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> d0[3][10];</div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="code" href="../../de/d6b/structdata32.html#a5e1912bcb128a3df4fa81e855042b285">   45</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="../../de/d6b/structdata32.html#a5e1912bcb128a3df4fa81e855042b285">counter</a>;</div>
<div class="line"><a name="l00046"></a><span class="lineno"><a class="code" href="../../de/d6b/structdata32.html#afc6c4324a70f38c5ec67f4f0aa8693bb">   46</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="../../de/d6b/structdata32.html#afc6c4324a70f38c5ec67f4f0aa8693bb">ruid</a>;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;}  <a class="code" href="../../de/d6b/structdata32.html">data32</a>;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno"><a class="code" href="../../dd/dc9/oncsSub__idmvtxv0_8cc.html#abe5096f41b357519d9c67b932f54452c">   49</a></span>&#160;<span class="preprocessor">#define CHIPHEADER     1</span></div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="code" href="../../dd/dc9/oncsSub__idmvtxv0_8cc.html#abf274a3bc789ebccca78dc40c427f4cd">   50</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define CHIPEMPTYFRAME 2</span></div>
<div class="line"><a name="l00051"></a><span class="lineno"><a class="code" href="../../dd/dc9/oncsSub__idmvtxv0_8cc.html#a8da7ea4ec6a0773eaa9165415c4acbcc">   51</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define DATASHORT      3</span></div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="code" href="../../dd/dc9/oncsSub__idmvtxv0_8cc.html#a1e18b0e564dce1099026aa9b9912b11a">   52</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define DATALONG0      4</span></div>
<div class="line"><a name="l00053"></a><span class="lineno"><a class="code" href="../../dd/dc9/oncsSub__idmvtxv0_8cc.html#a1910c314b3b267f87bf58d1b344a9bec">   53</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define DATALONG1      5</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#abda6e718f8cbabcfe9fbb10b4e8c4441">   55</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#abda6e718f8cbabcfe9fbb10b4e8c4441">oncsSub_idmvtxv0::decode_thebit</a>(<span class="keywordtype">int</span> the_row, <span class="keywordtype">int</span> encoder_id, <span class="keywordtype">int</span> address)<span class="keyword"> const</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="comment">// the numbering &quot;snakes&quot; its way through a column (fig. 4.5 in the Alpide manual)</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">//  0 1  &gt; &gt;    row 0 </span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">//  3 2  &lt; &lt;    row 1</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="comment">//  4 5  &gt; &gt;    row 2</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">//  7 6  &lt; &lt;   so we need to know if we are in an even or odd row</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordtype">int</span> is_an_odd_row = the_row &amp; 1;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordtype">int</span> thebit;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordflow">if</span> ( is_an_odd_row)</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    {</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        thebit = (encoder_id*2) + (  ( address &amp;1) ^ 1 );</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    }</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordflow">else</span>  </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        thebit = (encoder_id*2) + ( address&amp;1);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    }</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">return</span> thebit;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;}</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno"><a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad2338814ec6e58d641b6c77a4982a2cb">   75</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad2338814ec6e58d641b6c77a4982a2cb">oncsSub_idmvtxv0::print_stuff</a>(<a class="code" href="../../d8/dd6/event__io_8h.html#a401c254d356f0bd58122de53e7ca27b1">OSTREAM</a>&amp; out, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d23/Prototype2_2EMCal_2macros_2EnergyCalibFit_8m.html#a15fcda376b4587eb14bd059b030ea6b5">data</a>, <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> shift, <span class="keywordtype">bool</span> blank)<span class="keyword"> const</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../de/d8e/DrawPrototype2EMCalTower__ResolutionRecalib_8C.html#aea8b125da73831a723cfb9a8ce48f2d7">mask</a> = 0xffffffff;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">if</span> (width&lt;8) mask = ((1 &lt;&lt; width*4)-1);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordflow">if</span> (blank)</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>=0;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>&lt;width;<a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++) out &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        out &lt;&lt; std::hex &lt;&lt; SETW(width) &lt;&lt; std::setfill(&#39;0&#39;) &lt;&lt; ((data&gt;&gt;shift) &amp; mask);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;}</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno"><a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#af4eb751de0a072397bfa1ddde9831486">   85</a></span>&#160;<span class="keywordtype">int</span> *<a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#af4eb751de0a072397bfa1ddde9831486">oncsSub_idmvtxv0::decode</a> ()</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;{</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#aa8703a60ef4a64c5052daf2ee7cb3695">_is_decoded</a>) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#aa8703a60ef4a64c5052daf2ee7cb3695">_is_decoded</a> = 1;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *payload = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *) &amp;<a class="code" href="../../d8/d14/classoncsSubevent.html#aa822da1799e753b626da4d1321cff3e7">SubeventHdr</a>-&gt;<a class="code" href="../../dc/dde/structsubevt__data.html#a29b87195c93c258153fc5a2752351828">data</a>;  <span class="comment">// here begins the payload</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../d6/d21/fasthadv4_8h.html#ab80504e2b5f4d82ffd50a66c0e8050d4">dlength</a> = <a class="code" href="../../d8/d14/classoncsSubevent.html#abda06e714b47d12740596f86e9f372db">getLength</a>()-4 - <a class="code" href="../../d8/d14/classoncsSubevent.html#adf11eb72d6c19c6e6e3535bff393b2fb" title="get the number of padding units in the packet data.">getPadding</a>(); <span class="comment">//padding is supposed to be in units of dwords, this assumes dwords</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *the_end = ( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) &amp;payload[<a class="code" href="../../d6/d21/fasthadv4_8h.html#ab80504e2b5f4d82ffd50a66c0e8050d4">dlength</a>+1];</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/d11/Prototype2_2EMCal_2macros_2SaveCanvas_8m.html#aa8cfa700faab9c79570dccffdbb88d45">pos</a> = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) payload;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="comment">//  cout &lt;&lt; hex &lt;&lt; &quot; pos = &quot; &lt;&lt; (unsigned long long ) pos &lt;&lt; &quot;  the end  &quot; &lt;&lt; (unsigned long long) the_end &lt;&lt; dec &lt;&lt; endl;</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="comment">//pos = (unsigned char *) payload;</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="../../d7/da4/namespaceKFPMath.html#a1a60fb62c82cf122ca7923fc09cc1f84">b</a>;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    vector&lt;unsigned char&gt; ruchn_stream[<a class="code" href="../../d4/d03/oncsSub__idmvtxv0_8h.html#a9cc2f29007968c6b1f678db38d3d7206">MAXRUCHN</a>+1];</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> felix_counter = 0;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordflow">while</span> ( pos &lt; the_end )</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <a class="code" href="../../de/d6b/structdata32.html">data32</a> *d32 = ( <a class="code" href="../../de/d6b/structdata32.html">data32</a>*) pos; </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="keywordflow">if</span> (d32-&gt;<a class="code" href="../../de/d6b/structdata32.html#afc6c4324a70f38c5ec67f4f0aa8693bb">ruid</a> &gt; <a class="code" href="../../d4/d03/oncsSub__idmvtxv0_8h.html#add5f1c789f249f5779758832f3aab381">MAXRUID</a>)</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            <span class="comment">//cout &lt;&lt; __FILE__ &lt;&lt; &quot; &quot; &lt;&lt; __LINE__ &lt;&lt; &quot; --- invalid ruid &quot; &lt;&lt; hex &lt;&lt; (int) d32-&gt;ruid &lt;&lt; &quot; at pos &quot; &lt;&lt; (long) pos &lt;&lt; dec &lt;&lt; endl;</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a424e472a49ad87d4f368d2d03709cd46">_bad_ruid</a> = d32-&gt;<a class="code" href="../../de/d6b/structdata32.html#afc6c4324a70f38c5ec67f4f0aa8693bb">ruid</a>;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        }</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="comment">//FELIX counter is 8 bits, max value 256</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="comment">//check that the new counter value is consistent with the previous value (it should have increased by no more than 3, and the amount of the difference is the number of data chunks in this FELIX word)</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="keywordtype">int</span> counter_increment = (d32-&gt;<a class="code" href="../../de/d6b/structdata32.html#a5e1912bcb128a3df4fa81e855042b285">counter</a> + 256 - felix_counter)%256;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keywordflow">if</span> (counter_increment &gt; 3)</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        {</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            <span class="keywordflow">if</span> (d32-&gt;<a class="code" href="../../de/d6b/structdata32.html#a5e1912bcb128a3df4fa81e855042b285">counter</a> != 0)</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                <span class="comment">//cout &lt;&lt; __FILE__ &lt;&lt; &quot; &quot; &lt;&lt; __LINE__ &lt;&lt; &quot; --- unexpected FELIX counter &quot; &lt;&lt; hex &lt;&lt; (int) d32-&gt;counter &lt;&lt; &quot; following previous counter value &quot; &lt;&lt; felix_counter &lt;&lt; &quot; at pos &quot; &lt;&lt; (long) pos &lt;&lt; dec &lt;&lt; endl;</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a4840315980c57bc875ca1e68e17e5251">_unexpected_felix_counter</a> = d32-&gt;<a class="code" href="../../de/d6b/structdata32.html#a5e1912bcb128a3df4fa81e855042b285">counter</a>;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            }</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        }</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        felix_counter = d32-&gt;<a class="code" href="../../de/d6b/structdata32.html#a5e1912bcb128a3df4fa81e855042b285">counter</a>;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <span class="comment">//for (int ichnk = 0; ichnk &lt; 3; ichnk++)</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ichnk = 0; ichnk &lt; counter_increment; ichnk++)</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ruchn = (<span class="keywordtype">unsigned</span> int)d32-&gt;<a class="code" href="../../de/d6b/structdata32.html#aeb7e57246917d82b70c12153310c317f">d0</a>[ichnk][9];</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            <a class="code" href="../../db/d30/TPCRateData_8m.html#a2ae3b94a32881ed5840bebb9dd7954d2">if</a> (ruchn == <a class="code" href="../../d4/d03/oncsSub__idmvtxv0_8h.html#a6ae6688ed13d5538d529c3f07d8cfad6">RUHEADER</a>)</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                <span class="comment">//cout &lt;&lt; __FILE__ &lt;&lt; &quot; &quot; &lt;&lt; __LINE__ &lt;&lt; &quot; --- RU header &quot; &lt;&lt; hex &lt;&lt; ruchn &lt;&lt; &quot;, full RU word: &quot;;</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                <span class="comment">//for (int ibyte=9;ibyte&gt;=0;ibyte--)</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                <span class="comment">//{</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                <span class="comment">//cout &lt;&lt; setfill(&#39;0&#39;) &lt;&lt; setw(2) &lt;&lt; hex &lt;&lt; (unsigned int) d32-&gt;d0[ichnk][ibyte] &lt;&lt; &quot; &quot;;</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                <span class="comment">//}</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                <span class="comment">//cout &lt;&lt; setfill(&#39; &#39;) &lt;&lt; setw(0) &lt;&lt; dec &lt;&lt; endl;</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ruchn == <a class="code" href="../../d4/d03/oncsSub__idmvtxv0_8h.html#a06c42c6469653a02e9c96b6a2128a570">RUTRAILER</a>)</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                <span class="comment">//cout &lt;&lt; __FILE__ &lt;&lt; &quot; &quot; &lt;&lt; __LINE__ &lt;&lt; &quot; --- RU trailer &quot; &lt;&lt; hex &lt;&lt; ruchn &lt;&lt; &quot;, full RU word: &quot;;</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                <span class="comment">//for (int ibyte=9;ibyte&gt;=0;ibyte--)</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                <span class="comment">//{</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                <span class="comment">//cout &lt;&lt; setfill(&#39;0&#39;) &lt;&lt; setw(2) &lt;&lt; hex &lt;&lt; (unsigned int) d32-&gt;d0[ichnk][ibyte] &lt;&lt; &quot; &quot;;</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                <span class="comment">//}</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                <span class="comment">//cout &lt;&lt; setfill(&#39; &#39;) &lt;&lt; setw(0) &lt;&lt; dec &lt;&lt; endl;</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            }</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ruchn &gt; <a class="code" href="../../d4/d03/oncsSub__idmvtxv0_8h.html#a9cc2f29007968c6b1f678db38d3d7206">MAXRUCHN</a>)</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            {</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a8b700908534a559b3a688aad3fd09fc6">_bad_ruchns</a>++;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                cout &lt;&lt; __FILE__ &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; __LINE__ &lt;&lt; <span class="stringliteral">&quot; --- invalid ruchn &quot;</span> &lt;&lt; hex &lt;&lt; ruchn &lt;&lt; <span class="stringliteral">&quot;, full RU word: &quot;</span>;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ibyte=9;ibyte&gt;=0;ibyte--)</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                    cout &lt;&lt; setfill(<span class="charliteral">&#39;0&#39;</span>) &lt;&lt; setw(2) &lt;&lt; hex &lt;&lt; (<span class="keywordtype">unsigned</span> int) d32-&gt;<a class="code" href="../../de/d6b/structdata32.html#aeb7e57246917d82b70c12153310c317f">d0</a>[ichnk][ibyte] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                }</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                cout &lt;&lt; setfill(<span class="charliteral">&#39; &#39;</span>) &lt;&lt; setw(0) &lt;&lt; dec &lt;&lt; endl;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            }</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> ibyte = 0; ibyte &lt; 9; ibyte++)</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                <span class="comment">//cout &lt;&lt; __FILE__ &lt;&lt; &quot; &quot; &lt;&lt; __LINE__ &lt;&lt; hex &lt;&lt; &quot; --- ruchn &quot; &lt;&lt; ruchn &lt;&lt; &quot; byte &quot; &lt;&lt; (unsigned int) d32-&gt;d0[ichnk][ibyte] &lt;&lt; dec &lt;&lt; endl;</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                ruchn_stream[ruchn].push_back(d32-&gt;<a class="code" href="../../de/d6b/structdata32.html#aeb7e57246917d82b70c12153310c317f">d0</a>[ichnk][ibyte]);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            }</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        } <span class="comment">// ichnk</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        pos += <span class="keyword">sizeof</span>(*d32);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    } <span class="comment">// while (pos &lt; the_end)</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">//we ignore ruchn 0 (trigger information and padding words) for now</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">       if (ruchn_stream[0].size()!=9) for ( int ruchn = 0; ruchn &lt; MAXRUCHN+1; ruchn++)</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">       {</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">       cout &lt;&lt; __FILE__ &lt;&lt; &quot; &quot; &lt;&lt; __LINE__ &lt;&lt; &quot; --- ruchn &quot; &lt;&lt; ruchn &lt;&lt; &quot; has &quot; &lt;&lt; ruchn_stream[ruchn].size() &lt;&lt; &quot; bytes&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">       }</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> ruchn = 1; ruchn &lt; <a class="code" href="../../d4/d03/oncsSub__idmvtxv0_8h.html#a9cc2f29007968c6b1f678db38d3d7206">MAXRUCHN</a>+1; ruchn++)</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="keywordtype">bool</span> header_seen=<span class="keyword">false</span>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="keywordtype">int</span> status = 0;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="keywordtype">int</span> ibyte_endofdata = -1;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordtype">int</span> the_region = -1;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> address;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> encoder_id;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ibyte = 0; ibyte &lt; ruchn_stream[ruchn].size(); ibyte++)</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        {</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            b = ruchn_stream[ruchn].at(ibyte);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            <span class="comment">//cout &lt;&lt; __FILE__ &lt;&lt; &quot; &quot; &lt;&lt; __LINE__ &lt;&lt; &quot; --- ruchn &quot; &lt;&lt; hex &lt;&lt; ruchn &lt;&lt; &quot; next value &quot; &lt;&lt; (unsigned int)  b &lt;&lt; dec &lt;&lt; &quot; status:&quot; &lt;&lt; status &lt;&lt; endl;</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            <span class="keywordflow">if</span> (status) <span class="comment">// we mop up what we started in the last round -</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                <span class="comment">// these are all cases with more than one byte</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                <span class="keywordflow">switch</span> (status)</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                {</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="../../dd/dc9/oncsSub__idmvtxv0_8cc.html#abe5096f41b357519d9c67b932f54452c">CHIPHEADER</a>:</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                        <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#aa17f4c0fcaa43a401bdd61fa63471c3a">_bunchcounter</a>[ruchn] = <a class="code" href="../../d7/da4/namespaceKFPMath.html#a1a60fb62c82cf122ca7923fc09cc1f84">b</a>;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                        <span class="comment">//cout &lt;&lt; __FILE__ &lt;&lt; &quot; &quot; &lt;&lt; __LINE__ &lt;&lt; &quot; chip header, ruchn= &quot; &lt;&lt; ruchn &lt;&lt; &quot; bunchctr= &quot; &lt;&lt; hex &lt;&lt; _bunchcounter[ruchn] &lt;&lt; dec &lt;&lt; endl;</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                        <span class="keywordflow">if</span> ( (<span class="keywordtype">int</span>)ruchn &gt; <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad644193fc95b47a7c14178eb4a19d5b1">_highest_chip</a>) </div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                        {</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                            <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad644193fc95b47a7c14178eb4a19d5b1">_highest_chip</a> = ruchn; </div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                        }</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                        status = 0;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                        <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a9116c7596962d2c7e0cd463a33dbc28f">_header_found</a>[ruchn] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="../../dd/dc9/oncsSub__idmvtxv0_8cc.html#abf274a3bc789ebccca78dc40c427f4cd">CHIPEMPTYFRAME</a>:</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                        <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#aa17f4c0fcaa43a401bdd61fa63471c3a">_bunchcounter</a>[ruchn] = <a class="code" href="../../d7/da4/namespaceKFPMath.html#a1a60fb62c82cf122ca7923fc09cc1f84">b</a>;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                        <span class="comment">// cout &lt;&lt; __FILE__ &lt;&lt; &quot; &quot; &lt;&lt; __LINE__ &lt;&lt; &quot; chip empty frame &quot; &lt;&lt; hex &lt;&lt; ruchn &lt;&lt; &quot; &quot; &lt;&lt; _bunchcounter[ruchn] &lt;&lt; dec &lt;&lt; endl;</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                        <span class="keywordflow">if</span> ( (<span class="keywordtype">int</span>)ruchn &gt; <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad644193fc95b47a7c14178eb4a19d5b1">_highest_chip</a>) </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                        {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                            <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad644193fc95b47a7c14178eb4a19d5b1">_highest_chip</a> = ruchn; </div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                        }</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                        <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a1ee476a3583444ba2a88de2e03f9970e">_highest_region</a>[ruchn] = 0;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                        ibyte_endofdata = ibyte;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                        <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a9116c7596962d2c7e0cd463a33dbc28f">_header_found</a>[ruchn] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                        <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#afe00b0d7496da4f3d99f729cdfb04d41">_trailer_found</a>[ruchn] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                        status = 0;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="../../dd/dc9/oncsSub__idmvtxv0_8cc.html#a8da7ea4ec6a0773eaa9165415c4acbcc">DATASHORT</a>:</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                        address += <a class="code" href="../../d7/da4/namespaceKFPMath.html#a1a60fb62c82cf122ca7923fc09cc1f84">b</a>;   </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                        <span class="comment">//cout &lt;&lt; __FILE__ &lt;&lt; &quot; &quot; &lt;&lt; __LINE__ &lt;&lt; &quot; data short report, hex:&quot; &lt;&lt; hex &lt;&lt; address &lt;&lt; dec &lt;&lt; &quot; enc. id &quot; &lt;&lt; encoder_id &lt;&lt; &quot; address= &quot; &lt;&lt; address &lt;&lt; &quot; the_region:&quot; &lt;&lt; the_region &lt;&lt; &quot; ruchn:&quot; &lt;&lt; ruchn;</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                        <span class="keywordflow">if</span> ( the_region &gt;= 0 &amp;&amp; encoder_id &gt;=0 ) </div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                        {</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                            <span class="keywordtype">int</span> the_row = (address &gt;&gt; 1);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                            <span class="keywordflow">if</span> ( the_row &gt; 511)</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                            {</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                                cout &lt;&lt; __FILE__ &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; __LINE__ &lt;&lt; <span class="stringliteral">&quot; impossible row: &quot;</span> &lt;&lt; the_row</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                                    &lt;&lt; <span class="stringliteral">&quot; encoder &quot;</span> &lt;&lt;  encoder_id &lt;&lt; <span class="stringliteral">&quot; addr &quot;</span> &lt;&lt; address &lt;&lt; endl;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                            }</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                            {</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                                <span class="keywordtype">int</span> thebit = <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#abda6e718f8cbabcfe9fbb10b4e8c4441">decode_thebit</a>(the_row, encoder_id, address);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                                <span class="comment">//cout &lt;&lt; &quot; row:&quot; &lt;&lt; the_row &lt;&lt; &quot; col:&quot; &lt;&lt; the_region*32 + thebit &lt;&lt; endl;</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                                <span class="comment">//  cout &lt;&lt; __FILE__ &lt;&lt; &quot; &quot; &lt;&lt; __LINE__ &lt;&lt; &quot; the bit &quot; &lt;&lt; thebit &lt;&lt; endl;</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                                <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ab7dd5b3d859b50ef1e7d59a0d1a9449a">chip_row</a>[ruchn][the_row][the_region] |= ( 1&lt;&lt;thebit);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                                <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a5b6abdd915c2b42ec44ca5e446d98714">chip_rowmap</a>[ruchn][the_row] |= ( 1&lt;&lt;the_region);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                                <span class="keywordflow">if</span> ( the_row &gt; <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#afa0204c33ee474d131b380a25165862d">_highest_row_overall</a>)  <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#afa0204c33ee474d131b380a25165862d">_highest_row_overall</a> = the_row;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                            }</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                        }</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                        <span class="comment">//cout &lt;&lt; endl;</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                        status = 0;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="../../dd/dc9/oncsSub__idmvtxv0_8cc.html#a1e18b0e564dce1099026aa9b9912b11a">DATALONG0</a>:</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                        address += <a class="code" href="../../d7/da4/namespaceKFPMath.html#a1a60fb62c82cf122ca7923fc09cc1f84">b</a>;   </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                        status = <a class="code" href="../../dd/dc9/oncsSub__idmvtxv0_8cc.html#a1910c314b3b267f87bf58d1b344a9bec">DATALONG1</a>;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="../../dd/dc9/oncsSub__idmvtxv0_8cc.html#a1910c314b3b267f87bf58d1b344a9bec">DATALONG1</a>:</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                        <span class="keywordflow">if</span> ( (b &amp; 0x80) != 0) <span class="comment">//required to be 0</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                        {</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                            <span class="comment">//cout &lt;&lt; __FILE__ &lt;&lt; &quot; &quot; &lt;&lt; __LINE__ &lt;&lt; &quot; unexpected word &quot; &lt;&lt; hex &lt;&lt; (unsigned int) b &lt;&lt; dec &lt;&lt; &quot; at ibyte &quot; &lt;&lt; ibyte &lt;&lt; endl;</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                            <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a1ee592d9a050cff11890abb619342170">_unexpected_bytes</a>[ruchn]++;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                        }</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                        <span class="comment">//cout &lt;&lt; __FILE__ &lt;&lt; &quot; &quot; &lt;&lt; __LINE__ &lt;&lt; &quot; data long report, hex:&quot; &lt;&lt; hex &lt;&lt; address &lt;&lt; dec &lt;&lt; &quot; enc. id &quot; &lt;&lt; encoder_id &lt;&lt; &quot; address= &quot; &lt;&lt; address &lt;&lt; &quot; the_region:&quot; &lt;&lt; the_region &lt;&lt; &quot; ruchn:&quot; &lt;&lt; ruchn &lt;&lt; endl;</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                        <span class="comment">// Loop over the hits in the cluster. The pixel specified by the address always has a hit.</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                        <span class="comment">// The next 7 pixels (in priority encoder order) have hits if the corresponding bit in this byte is high. </span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                        <span class="comment">// See ALPIDE manual section 3.4.1 on DATA LONG: page 63.</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ihit = 0; ihit&lt;8; ihit++)</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                        {</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                            <span class="keywordflow">if</span> (ihit==0 || ((b &gt;&gt; (ihit-1)) &amp; 1))</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                            {</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                                <span class="keywordtype">int</span> hit_address = address + ihit;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                                <span class="keywordflow">if</span> ( the_region &gt;= 0 &amp;&amp; encoder_id &gt;=0 ) </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                                {</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                                    <span class="keywordtype">int</span> the_row = (hit_address &gt;&gt; 1);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                                    <span class="keywordflow">if</span> ( the_row &gt; 511)</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                                    {</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                                        cout &lt;&lt; __FILE__ &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; __LINE__ &lt;&lt; <span class="stringliteral">&quot; impossible row: &quot;</span> &lt;&lt; the_row</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                                            &lt;&lt; <span class="stringliteral">&quot; encoder &quot;</span> &lt;&lt;  encoder_id &lt;&lt; <span class="stringliteral">&quot; addr &quot;</span> &lt;&lt; hit_address &lt;&lt; endl;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                                    }</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                                    {</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                                        <span class="keywordtype">int</span> thebit = <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#abda6e718f8cbabcfe9fbb10b4e8c4441">decode_thebit</a>(the_row, encoder_id, hit_address);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                                        <span class="comment">//cout &lt;&lt; &quot; row:&quot; &lt;&lt; the_row &lt;&lt; &quot; col:&quot; &lt;&lt; the_region*32 + thebit &lt;&lt; endl;</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                                        <span class="comment">//  cout &lt;&lt; __FILE__ &lt;&lt; &quot; &quot; &lt;&lt; __LINE__ &lt;&lt; &quot; the bit &quot; &lt;&lt; thebit &lt;&lt; endl;</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                                        <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ab7dd5b3d859b50ef1e7d59a0d1a9449a">chip_row</a>[ruchn][the_row][the_region] |= ( 1&lt;&lt;thebit);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                                        <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a5b6abdd915c2b42ec44ca5e446d98714">chip_rowmap</a>[ruchn][the_row] |= ( 1&lt;&lt;the_region);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                                        <span class="keywordflow">if</span> ( the_row &gt; <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#afa0204c33ee474d131b380a25165862d">_highest_row_overall</a>)  <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#afa0204c33ee474d131b380a25165862d">_highest_row_overall</a> = the_row;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                                    }</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                                }</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                            }</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                        }</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                        status = 0;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                }</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            }</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            <span class="keywordflow">if</span> (ibyte_endofdata != -1) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            <span class="keywordflow">if</span> ( b == 0xff)  <span class="comment">// Idle byte, skip</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            {</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                <span class="comment">//cout &lt;&lt; __FILE__ &lt;&lt; &quot; &quot; &lt;&lt; __LINE__ &lt;&lt; &quot; IDLE byte &quot; &lt;&lt; hex &lt;&lt; (unsigned int)  b &lt;&lt; dec &lt;&lt; endl;</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                status = 0;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            }</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ( b &gt;&gt; 4) == 0xa) <span class="comment">// we have a chip header</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            {</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#adb98379eed23fff90768d6c94271f15b">_chip_id</a>[ruchn] = ( b &amp; 0xf);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                header_seen = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                status = <a class="code" href="../../dd/dc9/oncsSub__idmvtxv0_8cc.html#abe5096f41b357519d9c67b932f54452c">CHIPHEADER</a>;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            }</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ( b &gt;&gt; 4) == 0xb) <span class="comment">// we have a chip trailer</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            {</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                <span class="comment">// cout &lt;&lt; __FILE__ &lt;&lt; &quot; &quot; &lt;&lt; __LINE__ &lt;&lt; &quot; chip trailer, ruchn= &quot; &lt;&lt; hex &lt;&lt; ruchn &lt;&lt; dec &lt;&lt; endl;</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                <span class="comment">// break out of the loop, done with this chip</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                ibyte_endofdata = ibyte;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#afe00b0d7496da4f3d99f729cdfb04d41">_trailer_found</a>[ruchn] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ae558449fe46148bc1d6ec5e15d8ccd8b">_readout_flags</a>[ruchn] = (b &amp; 0xf);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            }</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ( b &gt;&gt; 4) == 0xE) <span class="comment">// we have a chip empty frame</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            {</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#adb98379eed23fff90768d6c94271f15b">_chip_id</a>[ruchn] = ( b &amp; 0xf);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                header_seen = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                status = <a class="code" href="../../dd/dc9/oncsSub__idmvtxv0_8cc.html#abf274a3bc789ebccca78dc40c427f4cd">CHIPEMPTYFRAME</a>;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            }</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ( b &gt;&gt; 5) == 0x6) <span class="comment">// we have a region header</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            {</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> region_id = (b &amp; 0x1f);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                <span class="keywordflow">if</span> ( region_id &lt;32)</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                {</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                    the_region = region_id;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                    <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a1ee476a3583444ba2a88de2e03f9970e">_highest_region</a>[ruchn] = region_id;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                }</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                <span class="keywordflow">else</span> <span class="comment">//this is impossible since the region ID is 5 bits</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                {</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                    cout &lt;&lt; __FILE__ &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; __LINE__ &lt;&lt; <span class="stringliteral">&quot; wrong region header, id=  &quot;</span> &lt;&lt; hex &lt;&lt; region_id &lt;&lt; dec &lt;&lt; endl;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                }</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            }</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ( b &gt;&gt; 6) == 0x1) <span class="comment">// we have a DATA short report</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            {</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                encoder_id = ( b&gt;&gt;2) &amp; 0xf;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                address = (b &amp; 0x3) &lt;&lt; 8;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                status = <a class="code" href="../../dd/dc9/oncsSub__idmvtxv0_8cc.html#a8da7ea4ec6a0773eaa9165415c4acbcc">DATASHORT</a>;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            }</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ( b &gt;&gt; 6) == 0x0) <span class="comment">// we have a DATA long report</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            {</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                encoder_id = ( b&gt;&gt;2) &amp; 0xf;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                address = (b &amp; 0x3) &lt;&lt; 8;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                status = <a class="code" href="../../dd/dc9/oncsSub__idmvtxv0_8cc.html#a1e18b0e564dce1099026aa9b9912b11a">DATALONG0</a>;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            }</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( b == 0xF1) <span class="comment">// we have a BUSY on</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            {</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                <span class="comment">//cout &lt;&lt; __FILE__ &lt;&lt; &quot; &quot; &lt;&lt; __LINE__ &lt;&lt; &quot; Busy on &quot;  &lt;&lt; endl;</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            }</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( b == 0xF0) <span class="comment">// we have a BUSY off</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                <span class="comment">//cout &lt;&lt; __FILE__ &lt;&lt; &quot; &quot; &lt;&lt; __LINE__ &lt;&lt; &quot; Busy off &quot;  &lt;&lt; endl;</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;            }</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            {</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                <span class="comment">//cout &lt;&lt; __FILE__ &lt;&lt; &quot; &quot; &lt;&lt; __LINE__ &lt;&lt; &quot; unexpected word &quot; &lt;&lt; hex &lt;&lt; (unsigned int) b &lt;&lt; dec &lt;&lt; &quot; at ibyte &quot; &lt;&lt; ibyte &lt;&lt; endl;</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a1ee592d9a050cff11890abb619342170">_unexpected_bytes</a>[ruchn]++;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;            }</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;            <span class="keywordflow">if</span> (ibyte==0 &amp;&amp; !header_seen) <span class="keywordflow">break</span>;<span class="comment">//first byte of the ALPIDE stream must be a chip header or chip empty; if not, abort so we don&#39;t get confused by bad data</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        } <span class="comment">// ibyte</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        <span class="comment">//cout &lt;&lt; __FILE__ &lt;&lt; &quot; &quot; &lt;&lt; __LINE__ &lt;&lt; &quot;  ruchn &quot; &lt;&lt; ruchn &lt;&lt; &quot;  ibyte_endofdata &quot; &lt;&lt; ibyte_endofdata &lt;&lt; endl;</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ibyte = ibyte_endofdata+1; ibyte &lt; ruchn_stream[ruchn].size(); ibyte++)</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        {</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            b = ruchn_stream[ruchn].at(ibyte);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            <span class="keywordflow">if</span> (b!=0)</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            {</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                <span class="comment">//cout &lt;&lt; __FILE__ &lt;&lt; &quot; &quot; &lt;&lt; __LINE__ &lt;&lt; &quot; --- ruchn &quot; &lt;&lt; hex &lt;&lt; ruchn &lt;&lt; &quot; unexpected nonzero value &quot; &lt;&lt; (unsigned int)  b &lt;&lt; dec &lt;&lt; &quot; at ibyte &quot; &lt;&lt; ibyte &lt;&lt; &quot; after ibyte_endofdata &quot; &lt;&lt; ibyte_endofdata &lt;&lt; endl;</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a3d44da2838da51c7ae651990db5095c8">_excess_data_bytes</a>++;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            }</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        }</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    } <span class="comment">// ruchn</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;}</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div>
<div class="line"><a name="l00400"></a><span class="lineno"><a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a74b59b2954cb6e3cf53ac2c955cddb83">  400</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a74b59b2954cb6e3cf53ac2c955cddb83">oncsSub_idmvtxv0::iValue</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> ich,<span class="keyword">const</span> <span class="keywordtype">char</span> *what)</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;{</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#af4eb751de0a072397bfa1ddde9831486">decode</a>();</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordflow">if</span> ( strcmp(what,<span class="stringliteral">&quot;UNEXPECTED_FELIX_COUNTER&quot;</span>) == 0 )</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    {</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a4840315980c57bc875ca1e68e17e5251">_unexpected_felix_counter</a>;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    }</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( strcmp(what,<span class="stringliteral">&quot;BAD_RUID&quot;</span>) == 0 )</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    {</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a424e472a49ad87d4f368d2d03709cd46">_bad_ruid</a>;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    }</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( strcmp(what,<span class="stringliteral">&quot;BAD_RUCHNS&quot;</span>) == 0 )</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    {</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a8b700908534a559b3a688aad3fd09fc6">_bad_ruchns</a>;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    }</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( strcmp(what,<span class="stringliteral">&quot;BAD_CHIPIDS&quot;</span>) == 0 )</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    {</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ac9fa17644bb527dfa9462fa23867078a">_bad_chipids</a>;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    }</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( strcmp(what,<span class="stringliteral">&quot;HIGHEST_CHIP&quot;</span>) == 0 )</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    {</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad644193fc95b47a7c14178eb4a19d5b1">_highest_chip</a>;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    }</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( strcmp(what,<span class="stringliteral">&quot;CHIP_ID&quot;</span>) == 0 )</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    {</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        <span class="keywordflow">if</span> ( ich &gt; <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad644193fc95b47a7c14178eb4a19d5b1">_highest_chip</a>) <span class="keywordflow">return</span> -1; <span class="comment">// no such chip</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#adb98379eed23fff90768d6c94271f15b">_chip_id</a>[ich];</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    }</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( strcmp(what,<span class="stringliteral">&quot;HIGHEST_REGION&quot;</span>) == 0 )</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    {</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <span class="keywordflow">if</span> ( ich &gt; <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad644193fc95b47a7c14178eb4a19d5b1">_highest_chip</a>) <span class="keywordflow">return</span> -1; <span class="comment">// no such chip</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a1ee476a3583444ba2a88de2e03f9970e">_highest_region</a>[ich];</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    }</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( strcmp(what,<span class="stringliteral">&quot;HIGHEST_ROW&quot;</span>) == 0 )</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    {</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#afa0204c33ee474d131b380a25165862d">_highest_row_overall</a>;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( strcmp(what,<span class="stringliteral">&quot;EXCESS_DATA_BYTES&quot;</span>) == 0 )</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    {</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a3d44da2838da51c7ae651990db5095c8">_excess_data_bytes</a>;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    }</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( strcmp(what,<span class="stringliteral">&quot;UNEXPECTED_BYTES&quot;</span>) == 0 )</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    {</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="keywordflow">if</span> ( ich &gt; <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad644193fc95b47a7c14178eb4a19d5b1">_highest_chip</a>) <span class="keywordflow">return</span> -1; <span class="comment">// no such chip</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a1ee592d9a050cff11890abb619342170">_unexpected_bytes</a>[ich];</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    }</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( strcmp(what,<span class="stringliteral">&quot;BUNCHCOUNTER&quot;</span>) == 0 )</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    {</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="keywordflow">if</span> ( ich &gt; <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad644193fc95b47a7c14178eb4a19d5b1">_highest_chip</a>) <span class="keywordflow">return</span> -1; <span class="comment">// no such chip</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#aa17f4c0fcaa43a401bdd61fa63471c3a">_bunchcounter</a>[ich];</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    }</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( strcmp(what,<span class="stringliteral">&quot;HEADER_FOUND&quot;</span>) == 0 )</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    {</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <span class="keywordflow">if</span> ( ich &gt; <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad644193fc95b47a7c14178eb4a19d5b1">_highest_chip</a>) <span class="keywordflow">return</span> -1; <span class="comment">// no such chip</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a9116c7596962d2c7e0cd463a33dbc28f">_header_found</a>[ich]?1:0;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    }</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( strcmp(what,<span class="stringliteral">&quot;TRAILER_FOUND&quot;</span>) == 0 )</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    {</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        <span class="keywordflow">if</span> ( ich &gt; <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad644193fc95b47a7c14178eb4a19d5b1">_highest_chip</a>) <span class="keywordflow">return</span> -1; <span class="comment">// no such chip</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#afe00b0d7496da4f3d99f729cdfb04d41">_trailer_found</a>[ich]?1:0;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    }</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( strcmp(what,<span class="stringliteral">&quot;READOUT_FLAGS&quot;</span>) == 0 )</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    {</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <span class="keywordflow">if</span> ( ich &gt; <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad644193fc95b47a7c14178eb4a19d5b1">_highest_chip</a>) <span class="keywordflow">return</span> -1; <span class="comment">// no such chip</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ae558449fe46148bc1d6ec5e15d8ccd8b">_readout_flags</a>[ich];</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    }</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;}</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div>
<div class="line"><a name="l00484"></a><span class="lineno"><a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#abdd5ee8c96df1fda92b0da88e22d9628">  484</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a74b59b2954cb6e3cf53ac2c955cddb83">oncsSub_idmvtxv0::iValue</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> chip, <span class="keyword">const</span> <span class="keywordtype">int</span> region, <span class="keyword">const</span> <span class="keywordtype">int</span> row)</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;{</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#af4eb751de0a072397bfa1ddde9831486">decode</a>();</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordflow">if</span> ( chip &lt; 0  || chip &gt; <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad644193fc95b47a7c14178eb4a19d5b1">_highest_chip</a>) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordflow">if</span> ( region &lt; 0 || region &gt; 31 ) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordflow">if</span> ( row &lt; 0    || row &gt; 511) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ab7dd5b3d859b50ef1e7d59a0d1a9449a">chip_row</a>[chip][row][region];</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;}</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div>
<div class="line"><a name="l00495"></a><span class="lineno"><a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a48ae90b9c6a8381adc4259037aa5308d">  495</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a74b59b2954cb6e3cf53ac2c955cddb83">oncsSub_idmvtxv0::iValue</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> chip, <span class="keyword">const</span> <span class="keywordtype">int</span> row)</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;{</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#af4eb751de0a072397bfa1ddde9831486">decode</a>();</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordflow">if</span> ( chip &lt; 0  || chip &gt; <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad644193fc95b47a7c14178eb4a19d5b1">_highest_chip</a>) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordflow">if</span> ( row &lt; 0    || row &gt; 511) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a5b6abdd915c2b42ec44ca5e446d98714">chip_rowmap</a>[chip][row];</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;}</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div>
<div class="line"><a name="l00505"></a><span class="lineno"><a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a72d8ed6332e8a1b0cf65177412ea8635">  505</a></span>&#160;<span class="keywordtype">void</span>  <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a72d8ed6332e8a1b0cf65177412ea8635">oncsSub_idmvtxv0::dump</a> ( <a class="code" href="../../d8/dd6/event__io_8h.html#a401c254d356f0bd58122de53e7ca27b1">OSTREAM</a>&amp; <a class="code" href="../../dd/d4f/MyFavoriteMartin_8C.html#acfd38cc0ea370d0cb45f8d3a46b1f81e">os</a> )</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;{</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <a class="code" href="../../d8/d14/classoncsSubevent.html#a034ce44b8a45992d0f69eceee75a93b2">identify</a>(os);</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="comment">//int x;</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#af4eb751de0a072397bfa1ddde9831486">decode</a>();</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;Highest chip:      &quot;</span> &lt;&lt; setw(4) &lt;&lt; <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a74b59b2954cb6e3cf53ac2c955cddb83">iValue</a>(0, <span class="stringliteral">&quot;HIGHEST_CHIP&quot;</span>) +1&lt;&lt; endl;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;Regions:              &quot;</span>;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> ichip = 0; ichip &lt; <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a74b59b2954cb6e3cf53ac2c955cddb83">iValue</a>(0, <span class="stringliteral">&quot;HIGHEST_CHIP&quot;</span>) +1; ichip++)</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    {</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        os &lt;&lt; setw(4) &lt;&lt; <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a74b59b2954cb6e3cf53ac2c955cddb83">iValue</a>(ichip, <span class="stringliteral">&quot;HIGHEST_REGION&quot;</span>);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    }</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    os &lt;&lt; endl;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;Highest populated row &quot;</span> &lt;&lt; <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a74b59b2954cb6e3cf53ac2c955cddb83">iValue</a>(0,<span class="stringliteral">&quot;HIGHEST_ROW&quot;</span>) &lt;&lt; endl;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="comment">// now dump the chip info</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> ichip = 0; ichip &lt; <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a74b59b2954cb6e3cf53ac2c955cddb83">iValue</a>(0, <span class="stringliteral">&quot;HIGHEST_CHIP&quot;</span>)+1; ichip++) <span class="comment">// go through the chips</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    {</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a74b59b2954cb6e3cf53ac2c955cddb83">iValue</a>(ichip, <span class="stringliteral">&quot;HIGHEST_REGION&quot;</span>) == -1) <span class="keywordflow">continue</span>; <span class="comment">// skip chips we didn&#39;t see</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        os &lt;&lt; <span class="stringliteral">&quot;  *** Chip &quot;</span> &lt;&lt; ichip &lt;&lt; <span class="stringliteral">&quot;, chip ID &quot;</span> &lt;&lt; <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a74b59b2954cb6e3cf53ac2c955cddb83">iValue</a>(ichip,<span class="stringliteral">&quot;CHIP_ID&quot;</span>) &lt;&lt;  <span class="stringliteral">&quot;  ***&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> irow = 0; irow &lt; <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a74b59b2954cb6e3cf53ac2c955cddb83">iValue</a>(0,<span class="stringliteral">&quot;HIGHEST_ROW&quot;</span>)+1; irow++)</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        {</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            <span class="keywordtype">bool</span> has_hit = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> iregion = 0; iregion &lt; <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a74b59b2954cb6e3cf53ac2c955cddb83">iValue</a>(ichip, <span class="stringliteral">&quot;HIGHEST_REGION&quot;</span>)+1; iregion++) <span class="comment">// check if there are any hits in this row</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            {</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a74b59b2954cb6e3cf53ac2c955cddb83">iValue</a>(ichip,iregion, irow) != 0)</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                {</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                    has_hit = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                }</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            }</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            <span class="keywordflow">if</span> (has_hit)</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            {</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                os &lt;&lt; <span class="stringliteral">&quot;  Row  Region&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> iregion = 0; iregion &lt; <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a74b59b2954cb6e3cf53ac2c955cddb83">iValue</a>(ichip, <span class="stringliteral">&quot;HIGHEST_REGION&quot;</span>)+1; iregion++)</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                {</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                    os &lt;&lt; setw(4) &lt;&lt; irow &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; setw(4) &lt;&lt; iregion &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bits =  <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#a74b59b2954cb6e3cf53ac2c955cddb83">iValue</a>(ichip,iregion, irow);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; 32; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                    {</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                        <span class="keywordflow">if</span> ( (bits &gt;&gt; <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>) &amp; 1)</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                        {</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                            os &lt;&lt; <span class="stringliteral">&quot;X&quot;</span>;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                        }</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                        {</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                            os &lt;&lt; <span class="stringliteral">&quot;-&quot;</span>;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                        }</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                    }</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                    os &lt;&lt; endl;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                }</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                os &lt;&lt; endl;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            }</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        }</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    }</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;}</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment">//copied from oncsSubevent.cc for a generic dump 12/21/17</span></div>
<div class="line"><a name="l00567"></a><span class="lineno"><a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ae0854436b8f557157a848812cb5cd162">  567</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ae0854436b8f557157a848812cb5cd162">oncsSub_idmvtxv0::gdump</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>, <a class="code" href="../../d8/dd6/event__io_8h.html#a401c254d356f0bd58122de53e7ca27b1">OSTREAM</a>&amp; out)<span class="keyword"> const</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="keywordtype">int</span> *SubeventData = &amp;<a class="code" href="../../d8/d14/classoncsSubevent.html#aa822da1799e753b626da4d1321cff3e7">SubeventHdr</a>-&gt;<a class="code" href="../../dc/dde/structsubevt__data.html#a29b87195c93c258153fc5a2752351828">data</a>;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../d7/d87/fasthadv4_8C.html#a37d972ae0b47b9099e30983131d31916">j</a>,l;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <a class="code" href="../../d8/d14/classoncsSubevent.html#a034ce44b8a45992d0f69eceee75a93b2">identify</a>(out);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keywordtype">int</span> current_offset;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> DWORDS_PER_WORD = 8;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordflow">switch</span> (i)</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    {</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <span class="keywordflow">case</span> (<a class="code" href="../../db/d5e/generalDefinitions_8h.html#ab948fa3f373c8a7efa3f85015e29ec50">EVT_HEXADECIMAL</a>):</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            <span class="comment">//j = 0;</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            current_offset = 0;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            <span class="keywordflow">while</span> (1)</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            {</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                <span class="keywordtype">int</span> dwords_remaining = <a class="code" href="../../d8/d14/classoncsSubevent.html#abda06e714b47d12740596f86e9f372db">getLength</a>()-<a class="code" href="../../d9/d4b/oncsSubConstants_8h.html#a01b6111325af69740153fc70f447eaa2">SEVTHEADERLENGTH</a> - <a class="code" href="../../d8/d14/classoncsSubevent.html#adf11eb72d6c19c6e6e3535bff393b2fb" title="get the number of padding units in the packet data.">getPadding</a>()/4 - current_offset; <span class="comment">//padding is supposed to be in units of dwords, this assumes bytes</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                out &lt;&lt; <a class="code" href="../../d8/dd6/event__io_8h.html#af58501c5658048a3ec0925de05f42464">SETW</a>(5) &lt;&lt; current_offset &lt;&lt; <span class="stringliteral">&quot; |  &quot;</span>;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                <span class="comment">//for (l=0;l&lt;DWORDS_PER_WORD;l++)</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                <span class="comment">//FELIX header</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad2338814ec6e58d641b6c77a4982a2cb">print_stuff</a>(out, SubeventData[current_offset+7], 4, 16, (dwords_remaining&lt;=7));</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                out &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                <span class="comment">//RU word 2</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad2338814ec6e58d641b6c77a4982a2cb">print_stuff</a>(out, SubeventData[current_offset+7], 4, 0, (dwords_remaining&lt;=7));</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad2338814ec6e58d641b6c77a4982a2cb">print_stuff</a>(out, SubeventData[current_offset+6], 8, 0, (dwords_remaining&lt;=6));</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad2338814ec6e58d641b6c77a4982a2cb">print_stuff</a>(out, SubeventData[current_offset+5], 8, 0, (dwords_remaining&lt;=5));</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                out &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                <span class="comment">//RU word 1</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad2338814ec6e58d641b6c77a4982a2cb">print_stuff</a>(out, SubeventData[current_offset+4], 8, 0, (dwords_remaining&lt;=4));</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad2338814ec6e58d641b6c77a4982a2cb">print_stuff</a>(out, SubeventData[current_offset+3], 8, 0, (dwords_remaining&lt;=3));</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad2338814ec6e58d641b6c77a4982a2cb">print_stuff</a>(out, SubeventData[current_offset+2], 4, 16, (dwords_remaining&lt;=2));</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                out &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                <span class="comment">//RU word 0</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad2338814ec6e58d641b6c77a4982a2cb">print_stuff</a>(out, SubeventData[current_offset+2], 4, 0, (dwords_remaining&lt;=2));</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad2338814ec6e58d641b6c77a4982a2cb">print_stuff</a>(out, SubeventData[current_offset+1], 8, 0, (dwords_remaining&lt;=1));</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                <a class="code" href="../../d5/dce/classoncsSub__idmvtxv0.html#ad2338814ec6e58d641b6c77a4982a2cb">print_stuff</a>(out, SubeventData[current_offset+0], 8, 0, (dwords_remaining&lt;=0));</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                out &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; std::dec &lt;&lt; std::endl &lt;&lt; std::setfill(<span class="charliteral">&#39; &#39;</span>);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                <span class="comment">//if (current_offset&gt;=SubeventHdr-&gt;sub_length-SEVTHEADERLENGTH - SubeventHdr-&gt;sub_padding) break;</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                <span class="comment">//if (current_offset&gt;=SubeventHdr-&gt;sub_length-SEVTHEADERLENGTH - SubeventHdr-&gt;sub_padding/4) break; //hack to deal with our incorrect padding in daq_device_felix.cc</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                <span class="keywordflow">if</span> (dwords_remaining&lt;8) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                current_offset += DWORDS_PER_WORD;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            }</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        <span class="keywordflow">case</span> (<a class="code" href="../../db/d5e/generalDefinitions_8h.html#ad7c15c4efd7b7d22edd05f17d08c05a4">EVT_DECIMAL</a>):</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;            j = 0;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            <span class="keywordflow">while</span> (1)</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            {</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                out &lt;&lt; std::dec &lt;&lt; std::endl &lt;&lt; <a class="code" href="../../d8/dd6/event__io_8h.html#af58501c5658048a3ec0925de05f42464">SETW</a>(5) &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot; |  &quot;</span>;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                <span class="keywordflow">for</span> (l=0;l&lt;6;l++)</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                {</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                    out &lt;&lt; <a class="code" href="../../d8/dd6/event__io_8h.html#af58501c5658048a3ec0925de05f42464">SETW</a>(10) &lt;&lt; SubeventData[j++] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                    <span class="keywordflow">if</span> (j&gt;=<a class="code" href="../../d8/d14/classoncsSubevent.html#aa822da1799e753b626da4d1321cff3e7">SubeventHdr</a>-&gt;<a class="code" href="../../dc/dde/structsubevt__data.html#afb59f463dc76d21048ab0c11e5a73149">sub_length</a>-<a class="code" href="../../d9/d4b/oncsSubConstants_8h.html#a01b6111325af69740153fc70f447eaa2">SEVTHEADERLENGTH</a> - <a class="code" href="../../d8/d14/classoncsSubevent.html#aa822da1799e753b626da4d1321cff3e7">SubeventHdr</a>-&gt;<a class="code" href="../../dc/dde/structsubevt__data.html#afe887f021425a156ac760897e8b0a709">sub_padding</a>) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                }</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                <span class="keywordflow">if</span> (j&gt;=<a class="code" href="../../d8/d14/classoncsSubevent.html#aa822da1799e753b626da4d1321cff3e7">SubeventHdr</a>-&gt;<a class="code" href="../../dc/dde/structsubevt__data.html#afb59f463dc76d21048ab0c11e5a73149">sub_length</a>-<a class="code" href="../../d9/d4b/oncsSubConstants_8h.html#a01b6111325af69740153fc70f447eaa2">SEVTHEADERLENGTH</a> - <a class="code" href="../../d8/d14/classoncsSubevent.html#aa822da1799e753b626da4d1321cff3e7">SubeventHdr</a>-&gt;<a class="code" href="../../dc/dde/structsubevt__data.html#afe887f021425a156ac760897e8b0a709">sub_padding</a>) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            }</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <span class="keywordflow">default</span>: </div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    }</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    out &lt;&lt; std::endl;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;}</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->

<!-- start footer part -->
<div id="nav-path" class="navpath">
	<!-- id is needed for treeview function! -->
	<ul>
		<li class="navelem"><a class="el" href="../../dir_b2524434354d28bb99970d47e87087b1.html">online_distribution</a></li><li class="navelem"><a class="el" href="../../dir_23476f4af6ed7a7c459fcfbccf6f30aa.html">blob</a></li><li class="navelem"><a class="el" href="../../dir_b8a2419f80040326d589e0b3b79cc999.html">master</a></li><li class="navelem"><a class="el" href="../../dir_9b8dcfd584cf66bd52e4995923368206.html">newbasic</a></li><li class="navelem"><a class="el" href="../../dd/dc9/oncsSub__idmvtxv0_8cc.html">oncsSub_idmvtxv0.cc</a></li>
		<li class="footer">
		Built by <a href="mailto:jhuang@bnl.gov">Jin Huang</a></em>.
			updated: <em>Mon Feb 17 2020 04:18:34</em> using <a
			href="http://www.doxygen.org/index.html"> <img class="footer"
				src="../../doxygen.png" alt="doxygen" /></a> 1.8.2 
				with <a href="https://github.com/sPHENIX-Collaboration">sPHENIX GitHub integration</a>
		</li>
	</ul>
</div>
</body>
</html>
